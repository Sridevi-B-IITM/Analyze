# Fix execute.py, convert data.xlsx to CSV, and publish result.json via GitHub Actions

## Overview

This repository collects metrics from a sales dataset and publishes the results as JSON to GitHub Pages. It includes:

- A fixed `execute.py` compatible with Python 3.11+ and pandas 2.3.
- A CSV counterpart of the provided `data.xlsx` (commit `data.csv`).
- A GitHub Actions workflow to:
  - Run ruff and show its output in CI logs.
  - Run `python execute.py > result.json`.
  - Publish `result.json` to GitHub Pages.

Key points:
- Do not commit `result.json`; it is generated by CI.
- `execute.py` prefers `data.csv` when present and falls back to `data.xlsx`.

## Setup

1. Place the given `data.xlsx` at the repository root (already provided by the task).
2. Create the following files/folders (copy from `index.html` of this app):
   - `execute.py`
   - `.github/workflows/ci.yml`
   - `.gitignore` (recommended to keep `result.json` untracked)
   - Optional helper: `convert_to_csv.py`

Python requirements (CI installs them automatically):
- Python 3.11
- pandas 2.3.x
- openpyxl (for reading `.xlsx`)
- ruff (for linting)

## Usage

1. Convert `data.xlsx` to CSV and commit it:
   - Run: `python convert_to_csv.py`
   - Commit: `git add data.csv && git commit -m "Add data.csv converted from data.xlsx"`

2. Commit the execute script and workflow:
   - `git add execute.py .github/workflows/ci.yml .gitignore`
   - `git commit -m "Fix execute.py, add CI to lint, run, and publish result.json"`

3. Push your changes:
   - `git push`

4. Verify CI:
   - In GitHub â†’ Actions, open the latest run.
   - You should see ruff output in the logs.
   - The job runs `python execute.py > result.json`, uploads it as a Pages artifact, and deploys to GitHub Pages.

5. Access your published JSON:
   - `https://<your-user-or-org>.github.io/<your-repo>/result.json`
   - The Actions summary also links to the Pages URL.

What `execute.py` computes:
- `row_count`: number of rows in the dataset.
- `regions_count`: count of distinct regions.
- `top_n_products_by_revenue` (n=3): top 3 products by total revenue.
- `rolling_7d_revenue_by_region`: for each region, the latest 7-day moving average of daily revenue.

Bug fix highlights:
- Correctly uses the `revenue` column (no `revenew` typo).
- Properly groups daily revenue by `region` and `date`, then applies a 7-day rolling mean, extracting the last value per region.
- Prints JSON to stdout for CI redirection.

Note on not committing `result.json`:
- The provided `.gitignore` includes `result.json` so it stays untracked.
- The workflow publishes `result.json` via GitHub Pages without adding it to the repository.

If you need to re-run locally:
- `python execute.py > result.json`
- Inspect the file or host it via any static server if desired.